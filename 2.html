<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>123</title>
    <link rel="stylesheet" href="s.css?7778899111">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>

<body>
<div id="err"></div>
<table id="itemGroups">
    <thead>
    <tr>
        <td>Наименование</td>
        <td>шт.</td>
        <td>THB</td>
        <td>Заказать</td>
    </tr>
    </thead>
</table>
<form>

    <div class="container">
        <fieldset>
            <label>Тайский номер телефона</label>
            <input type="text" placeholder="+66 ..." id="phone">
        </fieldset>
        <fieldset>
            <label>Доставка</label>
            <select id="delivery" onchange="calculateTotalCost()">
                <option disabled selected value="0">Выберите район доставки</option>
            </select>
        </fieldset>
        <fieldset>
            <label>Укажите точку доставки на Google Maps</label>
            <input type="text" placeholder="https://goo.gl/maps/..." id="gmap">
        </fieldset>
        <fieldset>
            <label>Способ оплаты</label>
            <select id="payment">
                <option>THB перевод на bank account</option>
                <option>USDT на крипто-кошелёк</option>
                <option>RUB перевод на карту</option>
            </select>
        </fieldset>
        <div class="total">Сумма: <span id="totalCost">0</span>THB / <span id="totalCostUSDT">0</span>USDT / <span
                id="totalCostRUB">0</span>RUB
        </div>
    </div>
</form>

<script>
    const phone = document.querySelector('#phone'),
        tambon = document.querySelector('#delivery'),
        gmap = document.querySelector('#gmap'),
        payment = document.querySelector('#payment');
    const form = document.querySelector('form');
    let tg = window.Telegram.WebApp;
    let deliverySelect = document.getElementById("delivery");
    let totalCost = document.getElementById("totalCost");
    let totalCostUSDT = document.getElementById("totalCostUSDT");
    let totalCostRUB = document.getElementById("totalCostRUB");
    let itemGroups = document.getElementById("itemGroups");
    let items;
    let filteredItems = [];
    let finaldata = {};
    let products = {};
    let err = document.getElementById(`err`);
    tg.expand();
    tg.MainButton.textColor = "#FFFFFF";
    tg.MainButton.color = "#2cab37";
    tg.MainButton.setText("Оформить заказ");

    function processItems(items) {
        let groupMap = new Map();
        for (let i = 0; i < items.length; i++) {
            let item = items[i];
            item.index = i;
            let price = item.folder.name;

            if (!groupMap.has(price)) {
                groupMap.set(price, []);
            }

            groupMap.get(price).push(item);
        }

        let groups = Array.from(groupMap.values());

        for (let i = 0; i < groups.length; i++) {
            let group = groups[i];
            itemGroups.innerHTML += `<tbody id="group-${i}"><tr style="background-color: transparent"><th>${group[0].folder.name}</th></tr></tbody>`;

            let groupList = document.getElementById(`group-${i}`);
            for (let j = 0; j < group.length; j++) {
                let item = group[j];
                let tempname = group[j].folder.name.replace(' 30g', '');
                let listItem = document.createElement("tr");
                item.incart = 0;
                listItem.innerHTML = `
                                <td>${item.name.replace(tempname, '')}</td>
                                <td>${item.quantity}</td>
                                <td>${item.salePrice * 0.01}</td>
                                <td>
                                <div class="number-input">
                                  <button onclick="this.parentNode.querySelector('input[type=number]').stepDown(); this.parentNode.querySelector('input[type=number]').dispatchEvent(new Event('change'))" ></button>
                                  <input class="quantity" name="quantity" type="number" min="0" max="${item.quantity}" value="${item.incart}" onchange="updateIncart(${item.index}, this.value)">
                                  <button onclick="this.parentNode.querySelector('input[type=number]').stepUp(); this.parentNode.querySelector('input[type=number]').dispatchEvent(new Event('change'))" class="plus"></button>
                                </div>
                                </td>
                              `;
                groupList.appendChild(listItem);
            }
        }
    }

    function calculateTotalCost() {
        let cost = 0;
        for (let i = 0; i < items.length; i++) {
            let item = items[i];
            cost += item.incart * item.salePrice * 0.01;
        }
        cost += Number(deliverySelect.value);
        totalCost.innerText = `${cost}`;
        totalCostUSDT.innerText = `${Math.round(cost * 0.03)}`;
        totalCostRUB.innerText = `${Math.round(cost * 2.2)}`;
        if (cost > 0) {
            tg.MainButton.show();
        } else {
            tg.MainButton.hide();
        }
        finaldata['итого'] = cost
    }

    fetch('http://127.0.0.2:8000/products/')
        .then(response => response.json())
        .then(data => {
            items = data;
            console.log('items fetched');
            processItems(items)
            calculateTotalCost();
        })
        .catch(error => {
            err.innerHTML += error;
            console.error(error);
        });
    let delivery = [
        {
            "meta": {
                "href": "https://online.moysklad.ru/api/remap/1.2/entity/service/d02a50a7-a2be-11ed-0a80-0eea001e64b6",
                "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/product/metadata",
                "type": "service",
                "mediaType": "application/json",
                "uuidHref": "https://online.moysklad.ru/app/#good/edit?id=d02a4a96-a2be-11ed-0a80-0eea001e64b4"
            },
            "id": "d02a50a7-a2be-11ed-0a80-0eea001e64b6",
            "accountId": "e154a3ce-7f99-11ed-0a80-07f300016d79",
            "owner": {
                "meta": {
                    "href": "https://online.moysklad.ru/api/remap/1.2/entity/employee/e3a72e1e-7f99-11ed-0a80-05a1003db532",
                    "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/employee/metadata",
                    "type": "employee",
                    "mediaType": "application/json",
                    "uuidHref": "https://online.moysklad.ru/app/#employee/edit?id=e3a72e1e-7f99-11ed-0a80-05a1003db532"
                }
            },
            "shared": true,
            "group": {
                "meta": {
                    "href": "https://online.moysklad.ru/api/remap/1.2/entity/group/e1554eef-7f99-11ed-0a80-07f300016d7a",
                    "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/group/metadata",
                    "type": "group",
                    "mediaType": "application/json"
                }
            },
            "updated": "2023-02-02 09:22:59.642",
            "name": "Rawai, Naiharn",
            "code": "00084",
            "externalCode": "s5h8cFn6jSxGXMcyXDhk01",
            "archived": false,
            "pathName": "Доставка",
            "productFolder": {
                "meta": {
                    "href": "https://online.moysklad.ru/api/remap/1.2/entity/productfolder/51e60605-a2bd-11ed-0a80-0fa5001d7ffe",
                    "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/productfolder/metadata",
                    "type": "productfolder",
                    "mediaType": "application/json",
                    "uuidHref": "https://online.moysklad.ru/app/#good/edit?id=51e60605-a2bd-11ed-0a80-0fa5001d7ffe"
                }
            },
            "useParentVat": true,
            "uom": {
                "meta": {
                    "href": "https://online.moysklad.ru/api/remap/1.2/entity/uom/481b1d19-ef67-4d64-8934-ebd4e892cbea",
                    "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/uom/metadata",
                    "type": "uom",
                    "mediaType": "application/json"
                }
            },
            "minPrice": {
                "value": 0.0,
                "currency": {
                    "meta": {
                        "href": "https://online.moysklad.ru/api/remap/1.2/entity/currency/e3bdc649-7f99-11ed-0a80-05a1003db584",
                        "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/currency/metadata",
                        "type": "currency",
                        "mediaType": "application/json",
                        "uuidHref": "https://online.moysklad.ru/app/#currency/edit?id=e3bdc649-7f99-11ed-0a80-05a1003db584"
                    }
                }
            },
            "salePrices": [
                {
                    "value": 30000.0,
                    "currency": {
                        "meta": {
                            "href": "https://online.moysklad.ru/api/remap/1.2/entity/currency/e3bdc649-7f99-11ed-0a80-05a1003db584",
                            "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/currency/metadata",
                            "type": "currency",
                            "mediaType": "application/json",
                            "uuidHref": "https://online.moysklad.ru/app/#currency/edit?id=e3bdc649-7f99-11ed-0a80-05a1003db584"
                        }
                    },
                    "priceType": {
                        "meta": {
                            "href": "https://online.moysklad.ru/api/remap/1.2/context/companysettings/pricetype/e3be968e-7f99-11ed-0a80-05a1003db585",
                            "type": "pricetype",
                            "mediaType": "application/json"
                        },
                        "id": "e3be968e-7f99-11ed-0a80-05a1003db585",
                        "name": "Цена продажи",
                        "externalCode": "cbcf493b-55bc-11d9-848a-00112f43529a"
                    }
                }
            ],
            "buyPrice": {
                "value": 0.0,
                "currency": {
                    "meta": {
                        "href": "https://online.moysklad.ru/api/remap/1.2/entity/currency/e3bdc649-7f99-11ed-0a80-05a1003db584",
                        "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/currency/metadata",
                        "type": "currency",
                        "mediaType": "application/json",
                        "uuidHref": "https://online.moysklad.ru/app/#currency/edit?id=e3bdc649-7f99-11ed-0a80-05a1003db584"
                    }
                }
            },
            "barcodes": [
                {
                    "ean13": "2000000000862"
                }
            ],
            "paymentItemType": "SERVICE",
            "discountProhibited": false,
            "files": {
                "meta": {
                    "href": "https://online.moysklad.ru/api/remap/1.2/entity/service/d02a50a7-a2be-11ed-0a80-0eea001e64b6/files",
                    "type": "files",
                    "mediaType": "application/json",
                    "size": 0,
                    "limit": 1000,
                    "offset": 0
                }
            }
        },
        {
            "meta": {
                "href": "https://online.moysklad.ru/api/remap/1.2/entity/service/14a2604f-a2c2-11ed-0a80-115b001ea65c",
                "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/product/metadata",
                "type": "service",
                "mediaType": "application/json",
                "uuidHref": "https://online.moysklad.ru/app/#good/edit?id=14a25adb-a2c2-11ed-0a80-115b001ea65a"
            },
            "id": "14a2604f-a2c2-11ed-0a80-115b001ea65c",
            "accountId": "e154a3ce-7f99-11ed-0a80-07f300016d79",
            "owner": {
                "meta": {
                    "href": "https://online.moysklad.ru/api/remap/1.2/entity/employee/e3a72e1e-7f99-11ed-0a80-05a1003db532",
                    "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/employee/metadata",
                    "type": "employee",
                    "mediaType": "application/json",
                    "uuidHref": "https://online.moysklad.ru/app/#employee/edit?id=e3a72e1e-7f99-11ed-0a80-05a1003db532"
                }
            },
            "shared": true,
            "group": {
                "meta": {
                    "href": "https://online.moysklad.ru/api/remap/1.2/entity/group/e1554eef-7f99-11ed-0a80-07f300016d7a",
                    "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/group/metadata",
                    "type": "group",
                    "mediaType": "application/json"
                }
            },
            "updated": "2023-02-02 09:23:17.174",
            "name": "Chalong, Kata, Karon",
            "code": "00085",
            "externalCode": "qDPBw-OOi0-16qE-fcdVZ3",
            "archived": false,
            "pathName": "Доставка",
            "productFolder": {
                "meta": {
                    "href": "https://online.moysklad.ru/api/remap/1.2/entity/productfolder/51e60605-a2bd-11ed-0a80-0fa5001d7ffe",
                    "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/productfolder/metadata",
                    "type": "productfolder",
                    "mediaType": "application/json",
                    "uuidHref": "https://online.moysklad.ru/app/#good/edit?id=51e60605-a2bd-11ed-0a80-0fa5001d7ffe"
                }
            },
            "useParentVat": true,
            "uom": {
                "meta": {
                    "href": "https://online.moysklad.ru/api/remap/1.2/entity/uom/481b1d19-ef67-4d64-8934-ebd4e892cbea",
                    "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/uom/metadata",
                    "type": "uom",
                    "mediaType": "application/json"
                }
            },
            "minPrice": {
                "value": 0.0,
                "currency": {
                    "meta": {
                        "href": "https://online.moysklad.ru/api/remap/1.2/entity/currency/e3bdc649-7f99-11ed-0a80-05a1003db584",
                        "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/currency/metadata",
                        "type": "currency",
                        "mediaType": "application/json",
                        "uuidHref": "https://online.moysklad.ru/app/#currency/edit?id=e3bdc649-7f99-11ed-0a80-05a1003db584"
                    }
                }
            },
            "salePrices": [
                {
                    "value": 50000.0,
                    "currency": {
                        "meta": {
                            "href": "https://online.moysklad.ru/api/remap/1.2/entity/currency/e3bdc649-7f99-11ed-0a80-05a1003db584",
                            "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/currency/metadata",
                            "type": "currency",
                            "mediaType": "application/json",
                            "uuidHref": "https://online.moysklad.ru/app/#currency/edit?id=e3bdc649-7f99-11ed-0a80-05a1003db584"
                        }
                    },
                    "priceType": {
                        "meta": {
                            "href": "https://online.moysklad.ru/api/remap/1.2/context/companysettings/pricetype/e3be968e-7f99-11ed-0a80-05a1003db585",
                            "type": "pricetype",
                            "mediaType": "application/json"
                        },
                        "id": "e3be968e-7f99-11ed-0a80-05a1003db585",
                        "name": "Цена продажи",
                        "externalCode": "cbcf493b-55bc-11d9-848a-00112f43529a"
                    }
                }
            ],
            "buyPrice": {
                "value": 0.0,
                "currency": {
                    "meta": {
                        "href": "https://online.moysklad.ru/api/remap/1.2/entity/currency/e3bdc649-7f99-11ed-0a80-05a1003db584",
                        "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/currency/metadata",
                        "type": "currency",
                        "mediaType": "application/json",
                        "uuidHref": "https://online.moysklad.ru/app/#currency/edit?id=e3bdc649-7f99-11ed-0a80-05a1003db584"
                    }
                }
            },
            "barcodes": [
                {
                    "ean13": "2000000000879"
                }
            ],
            "paymentItemType": "SERVICE",
            "discountProhibited": false,
            "files": {
                "meta": {
                    "href": "https://online.moysklad.ru/api/remap/1.2/entity/service/14a2604f-a2c2-11ed-0a80-115b001ea65c/files",
                    "type": "files",
                    "mediaType": "application/json",
                    "size": 0,
                    "limit": 1000,
                    "offset": 0
                }
            }
        },
        {
            "meta": {
                "href": "https://online.moysklad.ru/api/remap/1.2/entity/service/214f4ab3-a2c2-11ed-0a80-0eea001ef107",
                "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/product/metadata",
                "type": "service",
                "mediaType": "application/json",
                "uuidHref": "https://online.moysklad.ru/app/#good/edit?id=214f43bb-a2c2-11ed-0a80-0eea001ef105"
            },
            "id": "214f4ab3-a2c2-11ed-0a80-0eea001ef107",
            "accountId": "e154a3ce-7f99-11ed-0a80-07f300016d79",
            "owner": {
                "meta": {
                    "href": "https://online.moysklad.ru/api/remap/1.2/entity/employee/e3a72e1e-7f99-11ed-0a80-05a1003db532",
                    "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/employee/metadata",
                    "type": "employee",
                    "mediaType": "application/json",
                    "uuidHref": "https://online.moysklad.ru/app/#employee/edit?id=e3a72e1e-7f99-11ed-0a80-05a1003db532"
                }
            },
            "shared": true,
            "group": {
                "meta": {
                    "href": "https://online.moysklad.ru/api/remap/1.2/entity/group/e1554eef-7f99-11ed-0a80-07f300016d7a",
                    "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/group/metadata",
                    "type": "group",
                    "mediaType": "application/json"
                }
            },
            "updated": "2023-02-02 09:23:38.527",
            "name": "Kathu, Patong, Phuket Town",
            "code": "00086",
            "externalCode": "D6iK0pUUik3Vrr4ZQjPvE2",
            "archived": false,
            "pathName": "Доставка",
            "productFolder": {
                "meta": {
                    "href": "https://online.moysklad.ru/api/remap/1.2/entity/productfolder/51e60605-a2bd-11ed-0a80-0fa5001d7ffe",
                    "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/productfolder/metadata",
                    "type": "productfolder",
                    "mediaType": "application/json",
                    "uuidHref": "https://online.moysklad.ru/app/#good/edit?id=51e60605-a2bd-11ed-0a80-0fa5001d7ffe"
                }
            },
            "useParentVat": true,
            "uom": {
                "meta": {
                    "href": "https://online.moysklad.ru/api/remap/1.2/entity/uom/481b1d19-ef67-4d64-8934-ebd4e892cbea",
                    "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/uom/metadata",
                    "type": "uom",
                    "mediaType": "application/json"
                }
            },
            "minPrice": {
                "value": 0.0,
                "currency": {
                    "meta": {
                        "href": "https://online.moysklad.ru/api/remap/1.2/entity/currency/e3bdc649-7f99-11ed-0a80-05a1003db584",
                        "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/currency/metadata",
                        "type": "currency",
                        "mediaType": "application/json",
                        "uuidHref": "https://online.moysklad.ru/app/#currency/edit?id=e3bdc649-7f99-11ed-0a80-05a1003db584"
                    }
                }
            },
            "salePrices": [
                {
                    "value": 70000.0,
                    "currency": {
                        "meta": {
                            "href": "https://online.moysklad.ru/api/remap/1.2/entity/currency/e3bdc649-7f99-11ed-0a80-05a1003db584",
                            "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/currency/metadata",
                            "type": "currency",
                            "mediaType": "application/json",
                            "uuidHref": "https://online.moysklad.ru/app/#currency/edit?id=e3bdc649-7f99-11ed-0a80-05a1003db584"
                        }
                    },
                    "priceType": {
                        "meta": {
                            "href": "https://online.moysklad.ru/api/remap/1.2/context/companysettings/pricetype/e3be968e-7f99-11ed-0a80-05a1003db585",
                            "type": "pricetype",
                            "mediaType": "application/json"
                        },
                        "id": "e3be968e-7f99-11ed-0a80-05a1003db585",
                        "name": "Цена продажи",
                        "externalCode": "cbcf493b-55bc-11d9-848a-00112f43529a"
                    }
                }
            ],
            "buyPrice": {
                "value": 0.0,
                "currency": {
                    "meta": {
                        "href": "https://online.moysklad.ru/api/remap/1.2/entity/currency/e3bdc649-7f99-11ed-0a80-05a1003db584",
                        "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/currency/metadata",
                        "type": "currency",
                        "mediaType": "application/json",
                        "uuidHref": "https://online.moysklad.ru/app/#currency/edit?id=e3bdc649-7f99-11ed-0a80-05a1003db584"
                    }
                }
            },
            "barcodes": [
                {
                    "ean13": "2000000000886"
                }
            ],
            "paymentItemType": "SERVICE",
            "discountProhibited": false,
            "files": {
                "meta": {
                    "href": "https://online.moysklad.ru/api/remap/1.2/entity/service/214f4ab3-a2c2-11ed-0a80-0eea001ef107/files",
                    "type": "files",
                    "mediaType": "application/json",
                    "size": 0,
                    "limit": 1000,
                    "offset": 0
                }
            }
        },
        {
            "meta": {
                "href": "https://online.moysklad.ru/api/remap/1.2/entity/service/34541044-a2c2-11ed-0a80-0702001e48fe",
                "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/product/metadata",
                "type": "service",
                "mediaType": "application/json",
                "uuidHref": "https://online.moysklad.ru/app/#good/edit?id=3454094a-a2c2-11ed-0a80-0702001e48fc"
            },
            "id": "34541044-a2c2-11ed-0a80-0702001e48fe",
            "accountId": "e154a3ce-7f99-11ed-0a80-07f300016d79",
            "owner": {
                "meta": {
                    "href": "https://online.moysklad.ru/api/remap/1.2/entity/employee/e3a72e1e-7f99-11ed-0a80-05a1003db532",
                    "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/employee/metadata",
                    "type": "employee",
                    "mediaType": "application/json",
                    "uuidHref": "https://online.moysklad.ru/app/#employee/edit?id=e3a72e1e-7f99-11ed-0a80-05a1003db532"
                }
            },
            "shared": true,
            "group": {
                "meta": {
                    "href": "https://online.moysklad.ru/api/remap/1.2/entity/group/e1554eef-7f99-11ed-0a80-07f300016d7a",
                    "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/group/metadata",
                    "type": "group",
                    "mediaType": "application/json"
                }
            },
            "updated": "2023-02-02 09:24:14.178",
            "name": "Kamala, Surin, Bang Tao",
            "code": "00087",
            "externalCode": "PgA-s5VDgiQvZSsmr9nyk0",
            "archived": false,
            "pathName": "Доставка",
            "productFolder": {
                "meta": {
                    "href": "https://online.moysklad.ru/api/remap/1.2/entity/productfolder/51e60605-a2bd-11ed-0a80-0fa5001d7ffe",
                    "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/productfolder/metadata",
                    "type": "productfolder",
                    "mediaType": "application/json",
                    "uuidHref": "https://online.moysklad.ru/app/#good/edit?id=51e60605-a2bd-11ed-0a80-0fa5001d7ffe"
                }
            },
            "useParentVat": true,
            "uom": {
                "meta": {
                    "href": "https://online.moysklad.ru/api/remap/1.2/entity/uom/481b1d19-ef67-4d64-8934-ebd4e892cbea",
                    "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/uom/metadata",
                    "type": "uom",
                    "mediaType": "application/json"
                }
            },
            "minPrice": {
                "value": 0.0,
                "currency": {
                    "meta": {
                        "href": "https://online.moysklad.ru/api/remap/1.2/entity/currency/e3bdc649-7f99-11ed-0a80-05a1003db584",
                        "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/currency/metadata",
                        "type": "currency",
                        "mediaType": "application/json",
                        "uuidHref": "https://online.moysklad.ru/app/#currency/edit?id=e3bdc649-7f99-11ed-0a80-05a1003db584"
                    }
                }
            },
            "salePrices": [
                {
                    "value": 100000.0,
                    "currency": {
                        "meta": {
                            "href": "https://online.moysklad.ru/api/remap/1.2/entity/currency/e3bdc649-7f99-11ed-0a80-05a1003db584",
                            "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/currency/metadata",
                            "type": "currency",
                            "mediaType": "application/json",
                            "uuidHref": "https://online.moysklad.ru/app/#currency/edit?id=e3bdc649-7f99-11ed-0a80-05a1003db584"
                        }
                    },
                    "priceType": {
                        "meta": {
                            "href": "https://online.moysklad.ru/api/remap/1.2/context/companysettings/pricetype/e3be968e-7f99-11ed-0a80-05a1003db585",
                            "type": "pricetype",
                            "mediaType": "application/json"
                        },
                        "id": "e3be968e-7f99-11ed-0a80-05a1003db585",
                        "name": "Цена продажи",
                        "externalCode": "cbcf493b-55bc-11d9-848a-00112f43529a"
                    }
                }
            ],
            "buyPrice": {
                "value": 0.0,
                "currency": {
                    "meta": {
                        "href": "https://online.moysklad.ru/api/remap/1.2/entity/currency/e3bdc649-7f99-11ed-0a80-05a1003db584",
                        "metadataHref": "https://online.moysklad.ru/api/remap/1.2/entity/currency/metadata",
                        "type": "currency",
                        "mediaType": "application/json",
                        "uuidHref": "https://online.moysklad.ru/app/#currency/edit?id=e3bdc649-7f99-11ed-0a80-05a1003db584"
                    }
                }
            },
            "barcodes": [
                {
                    "ean13": "2000000000893"
                }
            ],
            "paymentItemType": "SERVICE",
            "discountProhibited": false,
            "files": {
                "meta": {
                    "href": "https://online.moysklad.ru/api/remap/1.2/entity/service/34541044-a2c2-11ed-0a80-0702001e48fe/files",
                    "type": "files",
                    "mediaType": "application/json",
                    "size": 0,
                    "limit": 1000,
                    "offset": 0
                }
            }
        }
    ]

    function filterItems() {
        filteredItems = items.filter(item => item.incart > 0);
        console.log(filteredItems);
        for (let i = 0; i < filteredItems.length; i++) {
            products[filteredItems[i].code] = filteredItems[i].incart
        }
        finaldata['products'] = products
        console.log(finaldata);
    }

    function updateIncart(index, value) {
        items[index].incart = Number(value);
        calculateTotalCost();
        filterItems();

    }


    for (let i = 0; i < delivery.length; i++) {
        let item = delivery[i];
        let itemPrice = item.salePrices[0].value * 0.01;
        let listItem = document.createElement("option");
        listItem.setAttribute('value', itemPrice);
        item.incart = 0;
        listItem.innerText = `${item.name} - ${itemPrice}THB`;
        deliverySelect.appendChild(listItem);
    }

    form.addEventListener('change', () => {
        finaldata['телефон'] = phone.value;
        finaldata['доставка'] = tambon.value;
        finaldata['оплата'] = payment.value;
        console.log(finaldata);
    });

    Telegram.WebApp.onEvent("mainButtonClicked", function () {
        finaldata['телефон'] = phone.value;
        finaldata['доставка'] = tambon.value;
        finaldata['оплата'] = payment.value;
        filterItems();
        tg.sendData(JSON.stringify(finaldata));
    });

</script>
</body>
</html>
